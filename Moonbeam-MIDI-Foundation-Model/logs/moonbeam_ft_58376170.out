Warning: unknown parameter pure_bf16
updated training config train_config(model_name='maestro', tokenizer_name=None, enable_fsdp=False, enable_ddp=True, low_cpu_fsdp=False, run_validation=True, validation_interval=10, batch_size_training=4, batching_strategy='packing', context_length=2048, gradient_accumulation_steps=1, gradient_clipping=False, gradient_clipping_threshold=1.0, num_epochs=10, max_train_step=0, max_eval_step=0, num_workers_dataloader=1, lr=0.0003, weight_decay=0.0, gamma=0.99, seed=42, use_fp16=False, mixed_precision=True, val_batch_size=4, peft_method='lora', use_peft=True, output_dir='/hpcwork/yh522379/moonbeam/checkpoints/fine-tuned/839M-10epoch', freeze_layers=False, num_freeze_layers=1, quantization=False, one_gpu=False, save_model=True, trained_checkpoint_path='/hpcwork/yh522379/moonbeam/checkpoints/pre-trained/moonbeam_839M.pt', dist_checkpoint_root_folder='/hpcwork/yh522379/moonbeam/checkpoints/fine-tuned/839M-10epoch', dist_checkpoint_folder='ddp', save_optimizer=False, use_fast_kernels=False, use_wandb=True, save_metrics=True, flop_counter=False, flop_counter_start=3, use_profiler=False, profiler_dir='PATH/to/save/profiler/results')
Warning: unknown parameter pure_bf16
updated training config train_config(model_name='maestro', tokenizer_name=None, enable_fsdp=False, enable_ddp=True, low_cpu_fsdp=False, run_validation=True, validation_interval=10, batch_size_training=4, batching_strategy='packing', context_length=2048, gradient_accumulation_steps=1, gradient_clipping=False, gradient_clipping_threshold=1.0, num_epochs=10, max_train_step=0, max_eval_step=0, num_workers_dataloader=1, lr=0.0003, weight_decay=0.0, gamma=0.99, seed=42, use_fp16=False, mixed_precision=True, val_batch_size=4, peft_method='lora', use_peft=True, output_dir='/hpcwork/yh522379/moonbeam/checkpoints/fine-tuned/839M-10epoch', freeze_layers=False, num_freeze_layers=1, quantization=False, one_gpu=False, save_model=True, trained_checkpoint_path='/hpcwork/yh522379/moonbeam/checkpoints/pre-trained/moonbeam_839M.pt', dist_checkpoint_root_folder='/hpcwork/yh522379/moonbeam/checkpoints/fine-tuned/839M-10epoch', dist_checkpoint_folder='ddp', save_optimizer=False, use_fast_kernels=False, use_wandb=True, save_metrics=True, flop_counter=False, flop_counter_start=3, use_profiler=False, profiler_dir='PATH/to/save/profiler/results')
Clearing GPU cache for all ranks
--> Running with torch dist debug set to detail
rope:inited
rope:inited
rope:inited
model_config:LlamaConfig {
  "architectures": "LlamaForCausalLM",
  "attention_bias": false,
  "attention_dropout": 0.0,
  "bos_token_id": 1,
  "decode_vocab_size": 8487,
  "decoder": {
    "_attn_implementation": "GRU",
    "attention_bias": false,
    "attention_dropout": 0.0,
    "hidden_act": "silu",
    "hidden_size": 1536,
    "intermediate_size": 1024,
    "max_position_embeddings": 7,
    "mlp_bias": false,
    "num_attention_heads": 16,
    "num_hidden_layers": 4,
    "num_key_value_heads": 4,
    "pretraining_tp": 1,
    "rms_norm_eps": 1e-05
  },
  "dur_embedding": {
    "base": 1031,
    "method": "FME"
  },
  "dur_vocab_size": 4099,
  "eos_token": -2,
  "eos_token_id": 2,
  "hidden_act": "silu",
  "hidden_size": 1920,
  "initializer_range": 0.02,
  "instrument_embedding": {
    "method": "WE",
    "vocab_size": 131
  },
  "instrument_vocab_size": 131,
  "intermediate_size": 6720,
  "max_len": 1024,
  "max_position_embeddings": 8192,
  "mlp_bias": false,
  "model_type": "llama",
  "num_attention_heads": 12,
  "num_hidden_layers": 15,
  "num_key_value_heads": 6,
  "octave_embedding": {
    "base": 19,
    "method": "FME"
  },
  "octave_vocab_size": 13,
  "onset_embedding": {
    "base": 199999,
    "method": "FME"
  },
  "onset_vocab_size": 4099,
  "pad_token": -3,
  "pitch_class_vocab_size": 14,
  "pitch_embedding": {
    "base": 20,
    "method": "FME"
  },
  "pretraining_tp": 1,
  "rms_norm_eps": 1e-05,
  "rope_scaling": null,
  "rope_theta": 500000.0,
  "rope_theta_dur": 1031,
  "rope_theta_octave": 19,
  "rope_theta_onset": 199999,
  "rope_theta_pitch": 20,
  "rope_theta_velocity": 131,
  "sos_token": -1,
  "tie_word_embeddings": false,
  "torch_dtype": "bfloat16",
  "transformers_version": "4.42.0.dev0",
  "use_cache": false,
  "velocity_embedding": {
    "base": 131,
    "method": "FME"
  },
  "velocity_vocab_size": 130,
  "vocab_size": 32000
}

rope:inited
rope:inited
rope:inited
model_config:LlamaConfig {
  "architectures": "LlamaForCausalLM",
  "attention_bias": false,
  "attention_dropout": 0.0,
  "bos_token_id": 1,
  "decode_vocab_size": 8487,
  "decoder": {
    "_attn_implementation": "GRU",
    "attention_bias": false,
    "attention_dropout": 0.0,
    "hidden_act": "silu",
    "hidden_size": 1536,
    "intermediate_size": 1024,
    "max_position_embeddings": 7,
    "mlp_bias": false,
    "num_attention_heads": 16,
    "num_hidden_layers": 4,
    "num_key_value_heads": 4,
    "pretraining_tp": 1,
    "rms_norm_eps": 1e-05
  },
  "dur_embedding": {
    "base": 1031,
    "method": "FME"
  },
  "dur_vocab_size": 4099,
  "eos_token": -2,
  "eos_token_id": 2,
  "hidden_act": "silu",
  "hidden_size": 1920,
  "initializer_range": 0.02,
  "instrument_embedding": {
    "method": "WE",
    "vocab_size": 131
  },
  "instrument_vocab_size": 131,
  "intermediate_size": 6720,
  "max_len": 1024,
  "max_position_embeddings": 8192,
  "mlp_bias": false,
  "model_type": "llama",
  "num_attention_heads": 12,
  "num_hidden_layers": 15,
  "num_key_value_heads": 6,
  "octave_embedding": {
    "base": 19,
    "method": "FME"
  },
  "octave_vocab_size": 13,
  "onset_embedding": {
    "base": 199999,
    "method": "FME"
  },
  "onset_vocab_size": 4099,
  "pad_token": -3,
  "pitch_class_vocab_size": 14,
  "pitch_embedding": {
    "base": 20,
    "method": "FME"
  },
  "pretraining_tp": 1,
  "rms_norm_eps": 1e-05,
  "rope_scaling": null,
  "rope_theta": 500000.0,
  "rope_theta_dur": 1031,
  "rope_theta_octave": 19,
  "rope_theta_onset": 199999,
  "rope_theta_pitch": 20,
  "rope_theta_velocity": 131,
  "sos_token": -1,
  "tie_word_embeddings": false,
  "torch_dtype": "bfloat16",
  "transformers_version": "4.42.0.dev0",
  "use_cache": false,
  "velocity_embedding": {
    "base": 131,
    "method": "FME"
  },
  "velocity_vocab_size": 130,
  "vocab_size": 32000
}

rope:inited
rope:inited
rope:inited
rope:inited
when loading checkpoint, encounter missing keys: ['model.onset_embedding.translation_bias', 'model.onset_embedding.linear_fme.weight', 'model.onset_embedding.linear_fme.bias', 'model.dur_embedding.translation_bias', 'model.dur_embedding.linear_fme.weight', 'model.dur_embedding.linear_fme.bias', 'model.octave_embedding.translation_bias', 'model.octave_embedding.linear_fme.weight', 'model.octave_embedding.linear_fme.bias', 'model.pitch_embedding.translation_bias', 'model.pitch_embedding.linear_fme.weight', 'model.pitch_embedding.linear_fme.bias', 'model.instrument_embedding.embedding.weight', 'model.velocity_embedding.translation_bias', 'model.velocity_embedding.linear_fme.weight', 'model.velocity_embedding.linear_fme.bias', 'model.supplementary_embedding.weight', 'model.supplementary_MLP.0.weight', 'model.supplementary_MLP.0.bias', 'model.supplementary_MLP.2.weight', 'model.supplementary_MLP.2.bias', 'model.layers.0.self_attn.q_proj.weight', 'model.layers.0.self_attn.k_proj.weight', 'model.layers.0.self_attn.v_proj.weight', 'model.layers.0.self_attn.o_proj.weight', 'model.layers.0.mlp.gate_proj.weight', 'model.layers.0.mlp.up_proj.weight', 'model.layers.0.mlp.down_proj.weight', 'model.layers.0.input_layernorm.weight', 'model.layers.0.post_attention_layernorm.weight', 'model.layers.1.self_attn.q_proj.weight', 'model.layers.1.self_attn.k_proj.weight', 'model.layers.1.self_attn.v_proj.weight', 'model.layers.1.self_attn.o_proj.weight', 'model.layers.1.mlp.gate_proj.weight', 'model.layers.1.mlp.up_proj.weight', 'model.layers.1.mlp.down_proj.weight', 'model.layers.1.input_layernorm.weight', 'model.layers.1.post_attention_layernorm.weight', 'model.layers.2.self_attn.q_proj.weight', 'model.layers.2.self_attn.k_proj.weight', 'model.layers.2.self_attn.v_proj.weight', 'model.layers.2.self_attn.o_proj.weight', 'model.layers.2.mlp.gate_proj.weight', 'model.layers.2.mlp.up_proj.weight', 'model.layers.2.mlp.down_proj.weight', 'model.layers.2.input_layernorm.weight', 'model.layers.2.post_attention_layernorm.weight', 'model.layers.3.self_attn.q_proj.weight', 'model.layers.3.self_attn.k_proj.weight', 'model.layers.3.self_attn.v_proj.weight', 'model.layers.3.self_attn.o_proj.weight', 'model.layers.3.mlp.gate_proj.weight', 'model.layers.3.mlp.up_proj.weight', 'model.layers.3.mlp.down_proj.weight', 'model.layers.3.input_layernorm.weight', 'model.layers.3.post_attention_layernorm.weight', 'model.layers.4.self_attn.q_proj.weight', 'model.layers.4.self_attn.k_proj.weight', 'model.layers.4.self_attn.v_proj.weight', 'model.layers.4.self_attn.o_proj.weight', 'model.layers.4.mlp.gate_proj.weight', 'model.layers.4.mlp.up_proj.weight', 'model.layers.4.mlp.down_proj.weight', 'model.layers.4.input_layernorm.weight', 'model.layers.4.post_attention_layernorm.weight', 'model.layers.5.self_attn.q_proj.weight', 'model.layers.5.self_attn.k_proj.weight', 'model.layers.5.self_attn.v_proj.weight', 'model.layers.5.self_attn.o_proj.weight', 'model.layers.5.mlp.gate_proj.weight', 'model.layers.5.mlp.up_proj.weight', 'model.layers.5.mlp.down_proj.weight', 'model.layers.5.input_layernorm.weight', 'model.layers.5.post_attention_layernorm.weight', 'model.layers.6.self_attn.q_proj.weight', 'model.layers.6.self_attn.k_proj.weight', 'model.layers.6.self_attn.v_proj.weight', 'model.layers.6.self_attn.o_proj.weight', 'model.layers.6.mlp.gate_proj.weight', 'model.layers.6.mlp.up_proj.weight', 'model.layers.6.mlp.down_proj.weight', 'model.layers.6.input_layernorm.weight', 'model.layers.6.post_attention_layernorm.weight', 'model.layers.7.self_attn.q_proj.weight', 'model.layers.7.self_attn.k_proj.weight', 'model.layers.7.self_attn.v_proj.weight', 'model.layers.7.self_attn.o_proj.weight', 'model.layers.7.mlp.gate_proj.weight', 'model.layers.7.mlp.up_proj.weight', 'model.layers.7.mlp.down_proj.weight', 'model.layers.7.input_layernorm.weight', 'model.layers.7.post_attention_layernorm.weight', 'model.layers.8.self_attn.q_proj.weight', 'model.layers.8.self_attn.k_proj.weight', 'model.layers.8.self_attn.v_proj.weight', 'model.layers.8.self_attn.o_proj.weight', 'model.layers.8.mlp.gate_proj.weight', 'model.layers.8.mlp.up_proj.weight', 'model.layers.8.mlp.down_proj.weight', 'model.layers.8.input_layernorm.weight', 'model.layers.8.post_attention_layernorm.weight', 'model.layers.9.self_attn.q_proj.weight', 'model.layers.9.self_attn.k_proj.weight', 'model.layers.9.self_attn.v_proj.weight', 'model.layers.9.self_attn.o_proj.weight', 'model.layers.9.mlp.gate_proj.weight', 'model.layers.9.mlp.up_proj.weight', 'model.layers.9.mlp.down_proj.weight', 'model.layers.9.input_layernorm.weight', 'model.layers.9.post_attention_layernorm.weight', 'model.layers.10.self_attn.q_proj.weight', 'model.layers.10.self_attn.k_proj.weight', 'model.layers.10.self_attn.v_proj.weight', 'model.layers.10.self_attn.o_proj.weight', 'model.layers.10.mlp.gate_proj.weight', 'model.layers.10.mlp.up_proj.weight', 'model.layers.10.mlp.down_proj.weight', 'model.layers.10.input_layernorm.weight', 'model.layers.10.post_attention_layernorm.weight', 'model.layers.11.self_attn.q_proj.weight', 'model.layers.11.self_attn.k_proj.weight', 'model.layers.11.self_attn.v_proj.weight', 'model.layers.11.self_attn.o_proj.weight', 'model.layers.11.mlp.gate_proj.weight', 'model.layers.11.mlp.up_proj.weight', 'model.layers.11.mlp.down_proj.weight', 'model.layers.11.input_layernorm.weight', 'model.layers.11.post_attention_layernorm.weight', 'model.layers.12.self_attn.q_proj.weight', 'model.layers.12.self_attn.k_proj.weight', 'model.layers.12.self_attn.v_proj.weight', 'model.layers.12.self_attn.o_proj.weight', 'model.layers.12.mlp.gate_proj.weight', 'model.layers.12.mlp.up_proj.weight', 'model.layers.12.mlp.down_proj.weight', 'model.layers.12.input_layernorm.weight', 'model.layers.12.post_attention_layernorm.weight', 'model.layers.13.self_attn.q_proj.weight', 'model.layers.13.self_attn.k_proj.weight', 'model.layers.13.self_attn.v_proj.weight', 'model.layers.13.self_attn.o_proj.weight', 'model.layers.13.mlp.gate_proj.weight', 'model.layers.13.mlp.up_proj.weight', 'model.layers.13.mlp.down_proj.weight', 'model.layers.13.input_layernorm.weight', 'model.layers.13.post_attention_layernorm.weight', 'model.layers.14.self_attn.q_proj.weight', 'model.layers.14.self_attn.k_proj.weight', 'model.layers.14.self_attn.v_proj.weight', 'model.layers.14.self_attn.o_proj.weight', 'model.layers.14.mlp.gate_proj.weight', 'model.layers.14.mlp.up_proj.weight', 'model.layers.14.mlp.down_proj.weight', 'model.layers.14.input_layernorm.weight', 'model.layers.14.post_attention_layernorm.weight', 'model.norm.weight', 'decoder.gru.weight_ih_l0', 'decoder.gru.weight_hh_l0', 'decoder.gru.bias_ih_l0', 'decoder.gru.bias_hh_l0', 'decoder.gru.weight_ih_l1', 'decoder.gru.weight_hh_l1', 'decoder.gru.bias_ih_l1', 'decoder.gru.bias_hh_l1', 'decoder.gru.weight_ih_l2', 'decoder.gru.weight_hh_l2', 'decoder.gru.bias_ih_l2', 'decoder.gru.bias_hh_l2', 'decoder.gru.weight_ih_l3', 'decoder.gru.weight_hh_l3', 'decoder.gru.bias_ih_l3', 'decoder.gru.bias_hh_l3', 'decoder.fc_out.weight', 'decoder.fc_out.bias', 'decoder_embedding.weight', 'summary_projection.weight', 'lm_head.weight']; unexpected_keys:['epoch', 'step', 'model_state_dict']
