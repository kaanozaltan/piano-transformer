Warning: unknown parameter pure_bf16
Warning: unknown parameter pure_bf16updated training config
 updated training configtrain_config(model_name='maestro', tokenizer_name=None, enable_fsdp=False, enable_ddp=True, low_cpu_fsdp=False, run_validation=True, validation_interval=10, batch_size_training=2, batching_strategy='packing', context_length=2048, gradient_accumulation_steps=1, gradient_clipping=False, gradient_clipping_threshold=1.0, num_epochs=10, max_train_step=0, max_eval_step=0, num_workers_dataloader=1, lr=0.0003, weight_decay=0.0, gamma=0.99, seed=42, use_fp16=False, mixed_precision=True, val_batch_size=2, peft_method='lora', use_peft=True, output_dir='/hpcwork/yh522379/moonbeam/checkpoints/fine-tuned/839M-10epoch', freeze_layers=False, num_freeze_layers=1, quantization=False, one_gpu=False, save_model=True, trained_checkpoint_path='/hpcwork/yh522379/moonbeam/checkpoints/pre-trained/moonbeam_839M.pt', dist_checkpoint_root_folder='/hpcwork/yh522379/moonbeam/checkpoints/fine-tuned/839M-10epoch', dist_checkpoint_folder='ddp', save_optimizer=False, use_fast_kernels=False, use_wandb=True, save_metrics=True, flop_counter=False, flop_counter_start=3, use_profiler=False, profiler_dir='PATH/to/save/profiler/results') 
train_config(model_name='maestro', tokenizer_name=None, enable_fsdp=False, enable_ddp=True, low_cpu_fsdp=False, run_validation=True, validation_interval=10, batch_size_training=2, batching_strategy='packing', context_length=2048, gradient_accumulation_steps=1, gradient_clipping=False, gradient_clipping_threshold=1.0, num_epochs=10, max_train_step=0, max_eval_step=0, num_workers_dataloader=1, lr=0.0003, weight_decay=0.0, gamma=0.99, seed=42, use_fp16=False, mixed_precision=True, val_batch_size=2, peft_method='lora', use_peft=True, output_dir='/hpcwork/yh522379/moonbeam/checkpoints/fine-tuned/839M-10epoch', freeze_layers=False, num_freeze_layers=1, quantization=False, one_gpu=False, save_model=True, trained_checkpoint_path='/hpcwork/yh522379/moonbeam/checkpoints/pre-trained/moonbeam_839M.pt', dist_checkpoint_root_folder='/hpcwork/yh522379/moonbeam/checkpoints/fine-tuned/839M-10epoch', dist_checkpoint_folder='ddp', save_optimizer=False, use_fast_kernels=False, use_wandb=True, save_metrics=True, flop_counter=False, flop_counter_start=3, use_profiler=False, profiler_dir='PATH/to/save/profiler/results')
Clearing GPU cache for all ranks
--> Running with torch dist debug set to detail
rope:inited
rope:inited
rope:inited
model_config:LlamaConfig {
  "architectures": "LlamaForCausalLM",
  "attention_bias": false,
  "attention_dropout": 0.0,
  "bos_token_id": 1,
  "decode_vocab_size": 8487,
  "decoder": {
    "_attn_implementation": "GRU",
    "attention_bias": false,
    "attention_dropout": 0.0,
    "hidden_act": "silu",
    "hidden_size": 1536,
    "intermediate_size": 1024,
    "max_position_embeddings": 7,
    "mlp_bias": false,
    "num_attention_heads": 16,
    "num_hidden_layers": 4,
    "num_key_value_heads": 4,
    "pretraining_tp": 1,
    "rms_norm_eps": 1e-05
  },
  "dur_embedding": {
    "base": 1031,
    "method": "FME"
  },
  "dur_vocab_size": 4099,
  "eos_token": -2,
  "eos_token_id": 2,
  "hidden_act": "silu",
  "hidden_size": 1920,
  "initializer_range": 0.02,
  "instrument_embedding": {
    "method": "WE",
    "vocab_size": 131
  },
  "instrument_vocab_size": 131,
  "intermediate_size": 6720,
  "max_len": 1024,
  "max_position_embeddings": 8192,
  "mlp_bias": false,
  "model_type": "llama",
  "num_attention_heads": 12,
  "num_hidden_layers": 15,
  "num_key_value_heads": 6,
  "octave_embedding": {
    "base": 19,
    "method": "FME"
  },
  "octave_vocab_size": 13,
  "onset_embedding": {
    "base": 199999,
    "method": "FME"
  },
  "onset_vocab_size": 4099,
  "pad_token": -3,
  "pitch_class_vocab_size": 14,
  "pitch_embedding": {
    "base": 20,
    "method": "FME"
  },
  "pretraining_tp": 1,
  "rms_norm_eps": 1e-05,
  "rope_scaling": null,
  "rope_theta": 500000.0,
  "rope_theta_dur": 1031,
  "rope_theta_octave": 19,
  "rope_theta_onset": 199999,
  "rope_theta_pitch": 20,
  "rope_theta_velocity": 131,
  "sos_token": -1,
  "tie_word_embeddings": false,
  "torch_dtype": "bfloat16",
  "transformers_version": "4.42.0.dev0",
  "use_cache": false,
  "velocity_embedding": {
    "base": 131,
    "method": "FME"
  },
  "velocity_vocab_size": 130,
  "vocab_size": 32000
}

rope:inited
rope:inited
rope:inited
model_config:LlamaConfig {
  "architectures": "LlamaForCausalLM",
  "attention_bias": false,
  "attention_dropout": 0.0,
  "bos_token_id": 1,
  "decode_vocab_size": 8487,
  "decoder": {
    "_attn_implementation": "GRU",
    "attention_bias": false,
    "attention_dropout": 0.0,
    "hidden_act": "silu",
    "hidden_size": 1536,
    "intermediate_size": 1024,
    "max_position_embeddings": 7,
    "mlp_bias": false,
    "num_attention_heads": 16,
    "num_hidden_layers": 4,
    "num_key_value_heads": 4,
    "pretraining_tp": 1,
    "rms_norm_eps": 1e-05
  },
  "dur_embedding": {
    "base": 1031,
    "method": "FME"
  },
  "dur_vocab_size": 4099,
  "eos_token": -2,
  "eos_token_id": 2,
  "hidden_act": "silu",
  "hidden_size": 1920,
  "initializer_range": 0.02,
  "instrument_embedding": {
    "method": "WE",
    "vocab_size": 131
  },
  "instrument_vocab_size": 131,
  "intermediate_size": 6720,
  "max_len": 1024,
  "max_position_embeddings": 8192,
  "mlp_bias": false,
  "model_type": "llama",
  "num_attention_heads": 12,
  "num_hidden_layers": 15,
  "num_key_value_heads": 6,
  "octave_embedding": {
    "base": 19,
    "method": "FME"
  },
  "octave_vocab_size": 13,
  "onset_embedding": {
    "base": 199999,
    "method": "FME"
  },
  "onset_vocab_size": 4099,
  "pad_token": -3,
  "pitch_class_vocab_size": 14,
  "pitch_embedding": {
    "base": 20,
    "method": "FME"
  },
  "pretraining_tp": 1,
  "rms_norm_eps": 1e-05,
  "rope_scaling": null,
  "rope_theta": 500000.0,
  "rope_theta_dur": 1031,
  "rope_theta_octave": 19,
  "rope_theta_onset": 199999,
  "rope_theta_pitch": 20,
  "rope_theta_velocity": 131,
  "sos_token": -1,
  "tie_word_embeddings": false,
  "torch_dtype": "bfloat16",
  "transformers_version": "4.42.0.dev0",
  "use_cache": false,
  "velocity_embedding": {
    "base": 131,
    "method": "FME"
  },
  "velocity_vocab_size": 130,
  "vocab_size": 32000
}

rope:inited
rope:inited
rope:inited
rope:inited
when loading checkpoint, encounter missing keys: []; unexpected_keys:[]
